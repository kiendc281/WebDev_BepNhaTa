<!-- Thông báo -->
<div *ngIf="notification.show" 
     class="notification" 
     [ngClass]="{'notification-success': notification.type === 'success', 'notification-error': notification.type === 'error'}">
  <div class="notification-content">
    <div *ngIf="notification.type === 'success'" class="notification-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
    </div>
    <div *ngIf="notification.type === 'error'" class="notification-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12" y2="16"></line>
      </svg>
    </div>
    <span>{{ notification.message }}</span>
  </div>
</div>

<div class="maincontainer">
  <div class="banner">
    <img src="../../assets/san-pham/banner.png" alt="" />
  </div>
  <div class="products-container">
    <div class="filter-bar">
      <div class="filter-button-container">
        <button
          *ngFor="let region of regions"
          [class.button-cam]="selectedRegion === region"
          [class.button-trang]="selectedRegion !== region"
          (click)="onRegionChange(region)"
        >
          {{ region }}
        </button>
      </div>
      <div class="search-container">
        <button class="button-trang">
          <img src="../../assets/cong-thuc/filter.svg" alt="Bộ lọc" />
          Bộ lọc
        </button>
        <div class="sort-dropdown">
          <button class="sort-button">
            Sắp xếp theo: {{ getSelectedSortLabel() }}
          </button>
          <div class="sort-options">
            <div
              *ngFor="let option of sortOptions"
              class="sort-option"
              (click)="selectSort(option.value)"
              [class.active]="selectedSort === option.value"
            >
              {{ option.label }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="loading-error" *ngIf="isLoading || errorMessage">
      <div class="loading" *ngIf="isLoading">Đang tải công thức...</div>
      <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>
    </div>
    <!-- Main content -->
    <div class="products-grid">
      <div class="product-card" *ngFor="let recipe of paginatedRecipes">
        <div *ngIf="!isRecipeSaved(recipe._id)" class="save-button" (click)="toggleSaveRecipe($event, recipe)">
          <img
            src="../../assets/san-pham/favourite.svg"
            alt="Lưu vào yêu thích"
          />
        </div>
        <!-- Indicator đã lưu -->
        <div *ngIf="isRecipeSaved(recipe._id)" class="position-absolute top-0 end-0 mt-2 me-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#dc3545" class="bi bi-heart-fill" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
          </svg>
        </div>
        <a [routerLink]="['/cong-thuc', recipe._id]">
          <img
            [src]="recipe.recipeImage"
            [alt]="recipe.recipeName"
            class="product-image"
            onerror="this.onerror=null; this.src='data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22300%22%20height%3D%22200%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20300%20200%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_18c0f0ef89a%20text%20%7B%20fill%3A%23AAAAAA%3Bfont-weight%3Abold%3Bfont-family%3AArial%2C%20Helvetica%2C%20Open%20Sans%2C%20sans-serif%2C%20monospace%3Bfont-size%3A15pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_18c0f0ef89a%22%3E%3Crect%20width%3D%22300%22%20height%3D%22200%22%20fill%3D%22%23EEEEEE%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%22110.0859375%22%20y%3D%22107.2%22%3EHình%20ảnh%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E'"
          />
          <div class="product-content">
            <h5 class="product-title">{{ recipe.recipeName }}</h5>
            <div class="product-info">
              <div class="info-item">
                <img src="../../assets/san-pham/khauphan.svg" alt="category" />
                <span>4 Người</span>
              </div>
              <div class="info-item">
                <img src="../../assets/san-pham/dokho.svg" alt="difficulty" />
                <span>{{ recipe.difficulty }}</span>
              </div>
              <div class="info-item">
                <img
                  src="../../assets/san-pham/ph-cooking-pot.svg"
                  alt="time"
                />
                <span>{{ recipe.time }}</span>
              </div>
            </div>
            <div class="product-actions">
              <button class="button-camnhat">XEM CHI TIẾT</button>
            </div>
          </div>
        </a>
      </div>
    </div>

    <div
      class="no-results"
      *ngIf="!isLoading && !errorMessage && filteredRecipes.length === 0"
    >
      <p>Không tìm thấy công thức nào phù hợp.</p>
    </div>

    <div class="pagination" *ngIf="filteredRecipes.length > itemsPerPage">
      <button
        class="page-number"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
      >
        ←
      </button>
      <button
        class="page-number"
        *ngFor="let page of displayedPages"
        [class.active]="currentPage === page"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>
      <button
        class="page-number"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
      >
        →
      </button>
    </div>
  </div>
</div>
