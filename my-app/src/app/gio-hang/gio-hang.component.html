<div class="container">
  <div class="row">
    <div class="col-md-6">
      <div class="checkout-info">
        <h2 class="section-title">Thông tin thanh toán</h2>

        <div class="form-group">
          <label for="fullname">Họ và tên</label>
          <input type="text" id="fullname" class="form-control" />
        </div>

        <div class="form-group">
          <label for="phone">Số điện thoại</label>
          <input type="text" id="phone" class="form-control" />
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" class="form-control" />
        </div>

        <div class="form-group">
          <label for="address">Địa chỉ</label>
          <input type="text" id="address" class="form-control" />
        </div>

        <div class="form-row">
          <div class="form-group col-md-4">
            <select class="form-control">
              <option selected disabled>Tỉnh/Thành phố</option>
            </select>
          </div>
          <div class="form-group col-md-4">
            <select class="form-control">
              <option selected disabled>Quận/huyện</option>
            </select>
          </div>
          <div class="form-group col-md-4">
            <select class="form-control">
              <option selected disabled>Xã/phường</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="note">Ghi chú</label>
          <input
            type="text"
            id="note"
            class="form-control"
            placeholder="Ghi chú thêm (Ví dụ: giao giờ hành chính)"
          />
        </div>

        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="saveAddress" />
          <label class="form-check-label" for="saveAddress"
            >Lưu vào sổ địa chỉ để dùng cho lần mua hàng tiếp theo</label
          >
        </div>

        <h2 class="section-title mt-4">Hình thức thanh toán</h2>

        <div class="payment-methods">
          <div class="payment-method">
            <input type="radio" id="cod" name="paymentMethod" checked />
            <label for="cod" class="payment-label">
              <div class="payment-icon cod-icon"></div>
              <span>COD</span>
            </label>
          </div>

          <div class="payment-method">
            <input type="radio" id="bank" name="paymentMethod" />
            <label for="bank" class="payment-label">
              <div class="payment-icon bank-icon"></div>
              <span>Chuyển khoản ngân hàng</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="cart-summary-container">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="section-title mb-0">Giỏ hàng</h2>
          <button
            class="btn btn-outline-secondary btn-sm"
            (click)="reloadCart()"
          >
            <i class="bi bi-arrow-repeat"></i> Tải lại giỏ hàng
          </button>
        </div>

        <div class="loading-overlay" *ngIf="loading">
          <div class="spinner"></div>
          <p>Đang tải giỏ hàng...</p>
        </div>

        <div
          class="empty-cart"
          *ngIf="!loading && (!cartItems || cartItems.length === 0)"
        >
          <div class="empty-cart-message">
            <i class="bi bi-cart-x-fill"></i>
            <p>Giỏ hàng của bạn đang trống</p>
            <button class="btn btn-primary" routerLink="/san-pham">
              Tiếp tục mua sắm
            </button>
          </div>
        </div>

        <div
          class="cart-content"
          *ngIf="!loading && cartItems && cartItems.length > 0"
        >
          <div class="cart-items-container">
            <div class="cart-header-new">
              <div class="header-checkbox">
                <input
                  type="checkbox"
                  id="select-all"
                  (change)="toggleSelectAll()"
                  [checked]="isAllSelected()"
                />
                <label for="select-all">Tất cả sản phẩm | Xóa sản phẩm</label>
              </div>
              <div class="header-quantity">Số lượng</div>
              <div class="header-price">Giá</div>
            </div>

            <div class="cart-items-list">
              <div
                class="cart-item-new"
                *ngFor="let item of cartItems; let i = index"
              >
                <div class="item-select">
                  <input
                    type="checkbox"
                    [id]="'select-item-' + i"
                    [(ngModel)]="item.selected"
                    (change)="onItemSelectionChange()"
                  />
                </div>

                <div class="item-info">
                  <img
                    [src]="item.mainImage"
                    [alt]="item.ingredientName"
                    class="item-image"
                  />
                  <div class="item-details">
                    <h4 class="item-name">{{ item.ingredientName }}</h4>
                  </div>
                </div>

                <div class="item-delete">
                  <button
                    class="delete-btn"
                    (click)="removeItem(item)"
                    title="Xóa sản phẩm"
                  >
                    <i class="bi bi-trash">Xóa</i>
                  </button>
                </div>

                <div class="item-quantity">
                  <div class="quantity-control-new">
                    <button
                      class="quantity-btn-new minus-btn"
                      (click)="updateQuantity(item, item.quantity - 1)"
                      [disabled]="item.quantity <= 1"
                    >
                      −
                    </button>
                    <span class="quantity-display">{{ item.quantity }}</span>
                    <button
                      class="quantity-btn-new plus-btn"
                      (click)="updateQuantity(item, item.quantity + 1)"
                    >
                      +
                    </button>
                  </div>
                </div>

                <div class="item-price">
                  {{ item.price | number : "1.0-0" }} đ
                </div>
              </div>
            </div>
          </div>

          <div class="cart-summary">
            <div class="summary-actions">
              <button class="btn btn-outline-danger" (click)="clearCart()">
                Xóa giỏ hàng
              </button>
              <button class="btn btn-outline-primary" routerLink="/san-pham">
                Tiếp tục mua sắm
              </button>
            </div>
            <div class="summary-details">
              <div class="summary-row">
                <span>Tổng số sản phẩm:</span>
                <span>{{ totalQuantity }}</span>
              </div>
              <div class="summary-row">
                <span>Tạm tính:</span>
                <span>{{ totalPrice | number : "1.0-0" }}đ</span>
              </div>
              <div class="summary-row">
                <span>Phí vận chuyển:</span>
                <span>Miễn phí</span>
              </div>
              <div class="summary-row total">
                <span>Tổng cộng:</span>
                <span>{{ totalPrice | number : "1.0-0" }}đ</span>
              </div>
              <button class="checkout-btn" (click)="proceedToCheckout()">
                Thanh toán
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="checkout-footer">
    <div class="delivery-info">
      <span
        ><img
          src="../../assets/gio-hang/car.svg"
          alt=""
          class="payment-icon"
        /><strong>COD</strong> thanh toán khi nhận hàng</span
      >
    </div>
    <div class="voucher-info">
      <strong>Chưa dùng Voucher</strong>
    </div>
    <button
      class="button-cam"
      [disabled]="!cartItems || cartItems.length === 0"
      (click)="proceedToCheckout()"
    >
      THANH TOÁN
    </button>
  </div>
</div>

<!-- Fixed bottom footer for mobile -->
<div class="mobile-checkout-bar">
  <div class="delivery-info">
    <div class="delivery-icon"></div>
    <span>COD thanh toán khi nhận hàng</span>
  </div>
  <div class="voucher-info">
    <span>Chưa dùng Voucher</span>
  </div>
  <button
    class="button-cam"
    [disabled]="!cartItems || cartItems.length === 0"
    (click)="proceedToCheckout()"
  >
    THANH TOÁN
  </button>
</div>
