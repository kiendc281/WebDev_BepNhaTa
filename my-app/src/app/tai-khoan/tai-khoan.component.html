<div class="main-container">
  <div class="container">
    <div class="container-leftpanel">
      <button
        class="button-trang"
        (click)="showContent('thong-tin')"
        [ngClass]="{ active: selectedCategory === 'thong-tin' }"
      >
        <div class="button-content">
          <img
            [src]="
              selectedCategory === 'thong-tin'
                ? 'assets/tai-khoan/thongtintk-trang.svg'
                : 'assets/tai-khoan/thongtintk-cam.svg'
            "
            alt="arrow"
          />
          Thông tin tài khoản
        </div>
        <img
          [src]="
            selectedCategory === 'thong-tin'
              ? 'assets/faq/cuida-arrow-right-outline-trang.svg'
              : 'assets/faq/cuida-arrow-right-outline.svg'
          "
          alt="arrow"
        />
      </button>
      <button
        class="button-trang"
        (click)="showContent('lich-su')"
        [ngClass]="{ active: selectedCategory === 'lich-su' }"
      >
        <div class="button-content">
          <img
            [src]="
              selectedCategory === 'lich-su'
                ? 'assets/tai-khoan/lichsudonhang-trang.svg'
                : 'assets/tai-khoan/lichsudonhang-cam.svg'
            "
            alt="arrow"
          />
          Lịch sử đơn hàng
        </div>
        <img
          [src]="
            selectedCategory === 'lich-su'
              ? 'assets/faq/cuida-arrow-right-outline-trang.svg'
              : 'assets/faq/cuida-arrow-right-outline.svg'
          "
          alt="arrow"
        />
      </button>
      <button
        class="button-trang"
        (click)="showContent('yeu-thich')"
        [ngClass]="{ active: selectedCategory === 'yeu-thich' }"
      >
        <div class="button-content">
          <img
            [src]="
              selectedCategory === 'yeu-thich'
                ? 'assets/tai-khoan/heart-trang.svg'
                : 'assets/tai-khoan/heart-cam.svg'
            "
            alt="arrow"
          />
          Mục yêu thích
        </div>
        <img
          [src]="
            selectedCategory === 'yeu-thich'
              ? 'assets/faq/cuida-arrow-right-outline-trang.svg'
              : 'assets/faq/cuida-arrow-right-outline.svg'
          "
          alt="arrow"
        />
      </button>
      <button
        class="button-trang"
        (click)="showContent('so-dia-chi')"
        [ngClass]="{ active: selectedCategory === 'so-dia-chi' }"
      >
        <div class="button-content">
          <img
            [src]="
              selectedCategory === 'so-dia-chi'
                ? 'assets/tai-khoan/location-trang.svg'
                : 'assets/tai-khoan/location-cam.svg'
            "
            alt="sổ địa chỉ"
          />
          Sổ địa chỉ
        </div>
        <img
          [src]="
            selectedCategory === 'so-dia-chi'
              ? 'assets/faq/cuida-arrow-right-outline-trang.svg'
              : 'assets/faq/cuida-arrow-right-outline.svg'
          "
          alt="arrow"
        />
      </button>
      <button class="button-trang" (click)="logout()">
        <div class="button-content">
          <img
            [src]="
              selectedCategory === 'dang-xuat'
                ? 'assets/tai-khoan/dangxuat-trang.svg'
                : 'assets/tai-khoan/dangxuat-cam.svg'
            "
            alt="arrow"
          />
          Đăng xuất
        </div>
        <img
          [src]="
            selectedCategory === 'dang-xuat'
              ? 'assets/faq/cuida-arrow-right-outline-trang.svg'
              : 'assets/faq/cuida-arrow-right-outline.svg'
          "
          alt="arrow"
        />
      </button>
    </div>

    <!-- THÔNG TIN TÀI KHOẢN -->
    <div
      class="container-rightpanel"
      *ngIf="selectedCategory === 'thong-tin'"
      id="thong-tin"
    >
      <h1>THÔNG TIN TÀI KHOẢN</h1>
      <div class="thong-tin-tai-khoan">
        <div class="thong-tin-tai-khoan-item">
          <div class="thong-tin-tai-khoan-item-label">Họ và tên:</div>
          <span [ngClass]="{ 'not-updated': !currentUser?.name }">{{
            currentUser?.name || "Chưa cập nhật"
          }}</span>
        </div>
        <div class="thong-tin-tai-khoan-item">
          <div class="thong-tin-tai-khoan-item-label">Email:</div>
          <span [ngClass]="{ 'not-updated': !currentUser?.email }">{{
            currentUser?.email || "Chưa cập nhật"
          }}</span>
        </div>
        <div class="thong-tin-tai-khoan-item">
          <div class="thong-tin-tai-khoan-item-label">Số điện thoại:</div>
          <span [ngClass]="{ 'not-updated': !currentUser?.phone }">{{
            currentUser?.phone || "Chưa cập nhật"
          }}</span>
        </div>
        <div class="thong-tin-tai-khoan-item">
          <div class="thong-tin-tai-khoan-item-label">Giới tính:</div>
          <span [ngClass]="{ 'not-updated': !currentUser?.gender }">{{
            currentUser?.gender || "Chưa cập nhật"
          }}</span>
        </div>
        <div class="thong-tin-tai-khoan-item">
          <div class="thong-tin-tai-khoan-item-label">Ngày sinh:</div>
          <span [ngClass]="{ 'not-updated': !formatBirthDate() }">{{
            formatBirthDate() || "Chưa cập nhật"
          }}</span>
        </div>
        <button class="button-trang" (click)="openUpdateModal()">
          CẬP NHẬT
        </button>
      </div>
      <h1>THÔNG TIN ĐĂNG NHẬP</h1>
      <div class="thong-tin-tai-khoan-item">
        <div class="thong-tin-tai-khoan-item-label">Email:</div>
        <span [ngClass]="{ 'not-updated': !currentUser?.email }">{{
          currentUser?.email || "Chưa cập nhật"
        }}</span>
      </div>
      <div class="thong-tin-tai-khoan-item">
        <div class="thong-tin-tai-khoan-item-label">Mật khẩu:</div>
        <span>********</span>
      </div>
      <button class="button-trang" (click)="openPasswordModal()">
        CẬP NHẬT
      </button>
    </div>

    <!-- LỊCH SỬ ĐƠN HÀNG -->
    <div
      class="container-rightpanel"
      *ngIf="selectedCategory === 'lich-su'"
      id="lich-su"
    >
      <h1>LỊCH SỬ ĐƠN HÀNG</h1>
    </div>

    <!-- MỤC YÊU THÍCH -->
    <div
      class="container-rightpanel"
      *ngIf="selectedCategory === 'yeu-thich'"
      id="yeu-thich"
    >
      <h1>MỤC YÊU THÍCH</h1>
    </div>

    <!-- SỔ ĐỊA CHỈ -->
    <div
      class="container-rightpanel"
      *ngIf="selectedCategory === 'so-dia-chi'"
      id="so-dia-chi"
    >
      <h1>SỔ ĐỊA CHỈ</h1>
    </div>
  </div>
</div>

<!-- Modal Cập nhật thông tin tài khoản -->
<div class="modal-overlay" *ngIf="showUpdateModal">
  <div class="modal-container">
    <div class="modal-header">
      <h4>Chỉnh sửa thông tin tài khoản</h4>
      <button class="close-button" (click)="closeUpdateModal()">
        <img
          src="../../assets/tai-khoan/zondicons-close-outline.svg"
          alt="Đóng"
        />
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="updateForm" (ngSubmit)="updateUserInfo()">
        <!-- Họ và tên -->
        <div
          class="form-group"
          [ngClass]="{
            'has-error':
              updateForm.get('name')?.invalid && updateForm.get('name')?.touched
          }"
        >
          <label>
            <img src="../../assets/tai-khoan/hovaten.svg" alt="User" />
            Họ và tên của bạn:
          </label>
          <input
            type="text"
            formControlName="name"
            placeholder="Nhập họ và tên"
          />
          <div
            *ngIf="
              updateForm.get('name')?.invalid && updateForm.get('name')?.touched
            "
            class="validation-error"
          >
            <span *ngIf="updateForm.get('name')?.hasError('required')"
              >Họ tên không được để trống</span
            >
          </div>
        </div>

        <!-- Email -->
        <div
          class="form-group"
          [ngClass]="{
            'has-error':
              updateForm.get('email')?.invalid &&
              updateForm.get('email')?.touched
          }"
        >
          <label>
            <img src="../../assets/tai-khoan/email.svg" alt="Email" />
            Email của bạn:
          </label>
          <input
            type="email"
            formControlName="email"
            placeholder="Nhập email"
          />
          <div
            *ngIf="
              updateForm.get('email')?.invalid &&
              updateForm.get('email')?.touched
            "
            class="validation-error"
          >
            <span *ngIf="updateForm.get('email')?.hasError('required')"
              >Email không được để trống</span
            >
            <span *ngIf="updateForm.get('email')?.hasError('email')"
              >Email không hợp lệ</span
            >
          </div>
        </div>

        <!-- Số điện thoại -->
        <div
          class="form-group"
          [ngClass]="{
            'has-error':
              updateForm.get('phone')?.invalid &&
              updateForm.get('phone')?.touched
          }"
        >
          <label>
            <img src="../../assets/tai-khoan/phone.svg" alt="Phone" />
            Số điện thoại
          </label>
          <input
            type="tel"
            formControlName="phone"
            placeholder="Nhập số điện thoại"
          />
          <div
            *ngIf="
              updateForm.get('phone')?.invalid &&
              updateForm.get('phone')?.touched
            "
            class="validation-error"
          >
            <span *ngIf="updateForm.get('phone')?.hasError('required')"
              >Số điện thoại không được để trống</span
            >
            <span *ngIf="updateForm.get('phone')?.hasError('pattern')"
              >Số điện thoại phải có 10 chữ số</span
            >
          </div>
        </div>

        <!-- Ngày sinh -->
        <div class="form-group">
          <label>
            <img src="../../assets/tai-khoan/dob.svg" alt="Birthday" />
            Ngày sinh của bạn
          </label>
          <div class="birthday-select">
            <div class="select-container">
              <select formControlName="day">
                <option *ngFor="let day of days" [value]="day">
                  Ngày {{ day }}
                </option>
              </select>
              <img
                src="../../assets/tai-khoan/icon-down.svg"
                alt="Dropdown"
                class="dropdown-icon"
              />
            </div>
            <div class="select-container">
              <select formControlName="month">
                <option *ngFor="let month of months" [value]="month">
                  Tháng {{ month }}
                </option>
              </select>
              <img
                src="../../assets/tai-khoan/icon-down.svg"
                alt="Dropdown"
                class="dropdown-icon"
              />
            </div>
            <div class="select-container">
              <select formControlName="year">
                <option *ngFor="let year of years" [value]="year">
                  Năm {{ year }}
                </option>
              </select>
              <img
                src="../../assets/tai-khoan/icon-down.svg"
                alt="Dropdown"
                class="dropdown-icon"
              />
            </div>
          </div>
        </div>

        <!-- Giới tính -->
        <div class="form-group">
          <div class="gender-options">
            <label class="radio-container">
              <input
                type="radio"
                formControlName="gender"
                value="Nam"
                [checked]="gender === 'Nam'"
                (change)="selectGender('Nam')"
              />
              <span class="radio-label">Nam</span>
            </label>
            <label class="radio-container">
              <input
                type="radio"
                formControlName="gender"
                value="Nữ"
                [checked]="gender === 'Nữ'"
                (change)="selectGender('Nữ')"
              />
              <span class="radio-label">Nữ</span>
            </label>
            <label class="radio-container">
              <input
                type="radio"
                formControlName="gender"
                value="Khác"
                [checked]="gender === 'Khác'"
                (change)="selectGender('Khác')"
              />
              <span class="radio-label">Khác</span>
            </label>
          </div>
        </div>

        <!-- Nút cập nhật -->
        <button
          type="submit"
          class="button-cam"
          [disabled]="updateForm.invalid"
        >
          CẬP NHẬT
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Modal Cập nhật thông tin đăng nhập (mật khẩu) -->
<div class="modal-overlay" *ngIf="showPasswordModal">
  <div class="modal-container">
    <div class="modal-header">
      <h4>Chỉnh sửa thông tin đăng nhập</h4>
      <button class="close-button" (click)="closePasswordModal()">
        <img
          src="../../assets/tai-khoan/zondicons-close-outline.svg"
          alt="Đóng"
        />
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="passwordForm" (ngSubmit)="updatePassword()">
        <!-- Mật khẩu cũ -->
        <div
          class="form-group password-field"
          [ngClass]="{
            'has-error':
              passwordForm.get('oldPassword')?.invalid &&
              passwordForm.get('oldPassword')?.touched
          }"
        >
          <label>
            <img src="../../assets/tai-khoan/lock.svg" alt="Password" />
            Mật khẩu cũ
          </label>
          <div class="password-input-container">
            <input
              [type]="showOldPassword ? 'text' : 'password'"
              formControlName="oldPassword"
              placeholder="Nhập mật khẩu cũ"
            />
            <img
              [src]="
                showOldPassword
                  ? '../../assets/tai-khoan/unhide.svg'
                  : '../../assets/tai-khoan/hideeye.svg'
              "
              alt="Toggle"
              class="toggle-password"
              (click)="togglePasswordVisibility('old')"
            />
          </div>
          <div
            *ngIf="
              passwordForm.get('oldPassword')?.invalid &&
              passwordForm.get('oldPassword')?.touched
            "
            class="validation-error"
          >
            <span *ngIf="passwordForm.get('oldPassword')?.hasError('required')"
              >Vui lòng nhập mật khẩu cũ</span
            >
          </div>
        </div>

        <!-- Mật khẩu mới -->
        <div
          class="form-group password-field"
          [ngClass]="{
            'has-error':
              passwordForm.get('newPassword')?.invalid &&
              passwordForm.get('newPassword')?.touched
          }"
        >
          <label>
            <img src="../../assets/tai-khoan/lock.svg" alt="Password" />
            Mật khẩu mới
          </label>
          <div class="password-input-container">
            <input
              [type]="showNewPassword ? 'text' : 'password'"
              formControlName="newPassword"
              placeholder="Nhập mật khẩu mới"
            />
            <img
              [src]="
                showNewPassword
                  ? '../../assets/tai-khoan/unhide.svg'
                  : '../../assets/tai-khoan/hideeye.svg'
              "
              alt="Toggle"
              class="toggle-password"
              (click)="togglePasswordVisibility('new')"
            />
          </div>
          <div
            *ngIf="
              passwordForm.get('newPassword')?.invalid &&
              passwordForm.get('newPassword')?.touched
            "
            class="validation-error"
          >
            <span *ngIf="passwordForm.get('newPassword')?.hasError('required')"
              >Vui lòng nhập mật khẩu mới</span
            >
            <span *ngIf="passwordForm.get('newPassword')?.hasError('minlength')"
              >Mật khẩu phải có ít nhất 8 ký tự</span
            >
            <span
              *ngIf="
                passwordForm.get('newPassword')?.hasError('strongPassword')
              "
              >Mật khẩu phải bao gồm chữ in hoa, số và ký tự đặc biệt</span
            >
          </div>
          <div class="mt-2 small">
            <ul>
              <li>Tối thiểu 8 ký tự</li>
              <li>Bao gồm chữ in hoa, số và ký tự đặc biệt</li>
            </ul>
          </div>
        </div>

        <!-- Xác nhận mật khẩu mới -->
        <div
          class="form-group password-field"
          [ngClass]="{
            'has-error':
              passwordForm.get('confirmPassword')?.invalid &&
              passwordForm.get('confirmPassword')?.touched
          }"
        >
          <label>
            <img src="../../assets/tai-khoan/lock.svg" alt="Password" />
            Xác nhận mật khẩu mới
          </label>
          <div class="password-input-container">
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="confirmPassword"
              placeholder="Xác nhận mật khẩu mới"
            />
            <img
              [src]="
                showConfirmPassword
                  ? '../../assets/tai-khoan/unhide.svg'
                  : '../../assets/tai-khoan/hideeye.svg'
              "
              alt="Toggle"
              class="toggle-password"
              (click)="togglePasswordVisibility('confirm')"
            />
          </div>
          <div
            *ngIf="
              passwordForm.get('confirmPassword')?.invalid &&
              passwordForm.get('confirmPassword')?.touched
            "
            class="validation-error"
          >
            <span
              *ngIf="passwordForm.get('confirmPassword')?.hasError('required')"
              >Vui lòng xác nhận mật khẩu mới</span
            >
            <span
              *ngIf="passwordForm.get('confirmPassword')?.hasError('noMatch')"
              >Mật khẩu xác nhận không khớp</span
            >
          </div>
        </div>

        <!-- Nút cập nhật -->
        <button
          type="submit"
          class="button-cam"
          [disabled]="passwordForm.invalid"
        >
          CẬP NHẬT
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Toast Container for Notifications -->
<div class="toast-container">
  <div
    *ngFor="let toast of toasts; let i = index"
    class="toast-message"
    [ngClass]="toast.type === 'success' ? 'toast-success' : 'toast-error'"
    [class.toast-fadeout]="toast.fading"
  >
    <div class="toast-icon">
      <img
        *ngIf="toast.type === 'success'"
        src="../../assets/tai-khoan/lets-icons-check-fill.svg"
        alt="Success"
      />
      <img
        *ngIf="toast.type === 'error'"
        src="../../assets/tai-khoan/material-symbols-error-outline.svg"
        alt="Error"
      />
    </div>
    <div class="toast-content">
      <div class="toast-title">{{ toast.title }}</div>
      <div class="toast-body">{{ toast.message }}</div>
    </div>
    <button class="toast-close" (click)="removeToast(i)">×</button>
  </div>
</div>
