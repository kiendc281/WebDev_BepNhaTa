<div class="product-container">
  <h1>Sản phẩm</h1>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="button-camnhat" (click)="addProduct()">Thêm sản phẩm</button>
    <button class="button-trang" (click)="batchImport()">Nhập hàng loạt</button>
    <button class="button-trang" (click)="batchExport()">Xuất hàng loạt</button>
  </div>

  <!-- Filter Tabs -->
  <div>
    <strong>
      <span>Tất cả ({{ totalItems }}) | </span>
      <span>Còn hàng ({{ getProductCountByStatus("Còn hàng") }}) | </span>
      <span>Hết hàng ({{ getProductCountByStatus("Hết hàng") }}) | </span>
      <span
        >Ngừng kinh doanh ({{
          getProductCountByStatus("Ngừng kinh doanh")
        }})</span
      >
    </strong>
  </div>

  <!-- Hiển thị lỗi -->
  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>

  <!-- Loading indicator -->
  <div class="loading" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Đang tải dữ liệu...</p>
  </div>

  <!-- Filters -->
  <div class="filter-section" *ngIf="!isLoading">
    <div class="search-box">
      <input
        type="text"
        placeholder="Tìm kiếm sản phẩm..."
        [(ngModel)]="searchTerm"
        (keyup)="search($event)"
      />
    </div>

    <div class="filter-dropdowns">
      <select [(ngModel)]="filterCategory" (change)="applyFilter()">
        <option value="">Tất cả danh mục</option>
        <option value="Xào">Xào</option>
        <option value="Nước">Nước</option>
        <option value="Món mặn">Món mặn</option>
        <option value="Trộn">Trộn</option>
      </select>

      <select [(ngModel)]="filterRegion" (change)="applyFilter()">
        <option value="">Tất cả vùng miền</option>
        <option value="Bắc">Miền Bắc</option>
        <option value="Trung">Miền Trung</option>
        <option value="Nam">Miền Nam</option>
      </select>

      <select [(ngModel)]="filterStatus" (change)="applyFilter()">
        <option value="">Tất cả trạng thái</option>
        <option value="Còn hàng">Còn hàng</option>
        <option value="Hết hàng">Hết hàng</option>
        <option value="Ngừng kinh doanh">Ngừng kinh doanh</option>
      </select>

      <button class="button-cam" (click)="applyFilter()">Lọc</button>
    </div>
  </div>

  <!-- Product Table -->
  <table class="product-table" *ngIf="!isLoading && products.length > 0">
    <thead>
      <tr>
        <th><input type="checkbox" /></th>
        <th class="sortable" (click)="sort('name')">
          Tên sản phẩm
          <img
            src="../../assets/product/sort.svg"
            alt="sort"
            class="sort-icon"
            [class.active]="sortColumn === 'ingredientName'"
            [class.desc]="
              sortColumn === 'ingredientName' && sortDirection === 'desc'
            "
          />
        </th>
        <th class="sortable" (click)="sort('code')">
          Mã sản phẩm
          <img
            src="../../assets/product/sort.svg"
            alt="sort"
            class="sort-icon"
            [class.active]="sortColumn === '_id'"
            [class.desc]="sortColumn === '_id' && sortDirection === 'desc'"
          />
        </th>
        <th>Trạng thái</th>
        <th class="sortable" (click)="sort('price')">
          Giá
          <img
            src="../../assets/product/sort.svg"
            alt="sort"
            class="sort-icon"
            [class.active]="sortColumn === 'price'"
            [class.desc]="sortColumn === 'price' && sortDirection === 'desc'"
          />
        </th>
        <th>Danh mục</th>
        <th>Thẻ</th>
        <th class="sortable" (click)="sort('date')">
          Ngày hết hạn
          <img
            src="../../assets/product/sort.svg"
            alt="sort"
            class="sort-icon"
            [class.active]="sortColumn === 'timestamp'"
            [class.desc]="
              sortColumn === 'timestamp' && sortDirection === 'desc'
            "
          />
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let product of products">
        <td><input type="checkbox" /></td>
        <td>{{ product.name }}</td>
        <td>{{ product.code }}</td>
        <td>
          <span
            class="product-status"
            [ngClass]="{
              'status-instock': product.status === 'Còn hàng',
              'status-outofstock': product.status === 'Hết hàng',
              'status-discontinued': product.status === 'Ngừng kinh doanh'
            }"
            >{{ product.status }}</span
          >
        </td>
        <td class="product-price">{{ product.price }}</td>
        <td>{{ product.category }}</td>
        <td>
          <span class="product-tag" *ngFor="let tag of product.tags">{{
            tag
          }}</span>
        </td>
        <td>{{ product.date }}</td>
      </tr>
    </tbody>
  </table>

  <!-- Không có dữ liệu -->
  <div class="no-data" *ngIf="!isLoading && products.length === 0">
    <p>Không có sản phẩm nào phù hợp với tiêu chí tìm kiếm.</p>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="!isLoading && totalItems > 0">
    <button
      [disabled]="currentPage === 1"
      (click)="currentPage = currentPage - 1"
      class="page-button"
    >
      <i class="fas fa-chevron-left"></i>
    </button>

    <div
      *ngFor="let page of getPageArray()"
      class="page-button"
      [class.active]="currentPage === page"
      (click)="currentPage = page"
    >
      {{ page }}
    </div>

    <button
      [disabled]="currentPage === getTotalPages()"
      (click)="currentPage = currentPage + 1"
      class="page-button"
    >
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>
